const Toast=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}});let table,estatus_tag,debounceTimer,ciclo_escolar=$("#ciclo").val(),id_grupo=getParameterByName("id_grupo"),nivel=getParameterByName("nivel"),grado=getParameterByName("grado"),nombre_grupo=getParameterByName("nombre");import{initCustomDataTable}from"../DataTable/datatables-init.js";import{DataTableListener,GeneralEventListener}from"../utils/listeners.js";function reloadTable(){$("#role").attr("role");table=initCustomDataTable("#detalle_grupo",BASE_URL+"api/grupos.php?tipo=datatable_grupo&id_grupo="+id_grupo+"&ciclo="+ciclo_escolar,[{data:"id",title:"#"},{data:"nombre",title:"Nombre"},{data:null,title:"Apellidos",render:e=>e.apellido_paterno+" "+e.apellido_materno},{data:null,title:"Estatus",render:e=>(estatus_tag=1==e.estatus?'<span class="badge bg-success">Activo</span>':'<span class="badge bg-secondary">Inactivo</span>',estatus_tag)},{data:null,title:"Opciones",render:function(e,a,t){return 1!=e.estatus?"\n            <div class='row'>\n            <div class='col-12 col-md-12'>\n              <div class=\"btn btn-info btn-reactivar\">\n              <i class=\"fa-solid fa-rotate-left\"></i>\n              </div>\n            </div>\n          </div>\n            ":"\n          <div class='row'>\n            <div class='col-12 col-md-12'>\n              <div class=\"btn btn-danger btn-cancelar\">\n                <i class=\"fa-solid fa-trash\"></i>\n              </div>\n            </div>\n          </div>"}}]),DataTableListener(table,"click",".btn-cancelar",cancelarAlumnoGrupo),DataTableListener(table,"click",".btn-reactivar",reactivarAlumnoGrupo)}function actualizarGrupo(){let e=$("#nombre-grupo").val();console.log(e);let a=$("#grado").val(),t=$("#nivel").val(),o=$("#ciclo").val();e||Toast.fire({icon:"error",title:"Escribe un nombre para el grupo"}),a||Toast.fire({icon:"error",title:"Seleccione un grado"}),t||Toast.fire({icon:"error",title:"Selecciona un nivel"}),$.ajax({type:"post",url:BASE_URL+"api/grupos.php?tipo=actualizar",data:{nombre:e,nivel:t,grado:a,ciclo:o,id_grupo:id_grupo},dataType:"json",success:function(e){table.ajax.reload(null,!1),e.estatus?(Swal.fire({icon:"success",title:e.mensaje,confirmButtonText:"Entendido",showCloseButton:!0,html:`<h4 style="color:rgba(100, 150, 200)">${e.subtitulo}</h4>`}),$("#nombre-horario").val(""),$("#grado").val(""),$("#nivel").val(""),$("#ciclo").val("")):Swal.fire({icon:"error",title:e.mensaje,confirmButtonText:"Entendido",showCloseButton:!0,html:`<h4 style="color:rgba(100, 150, 200)">${e.subtitulo}</h4>`})}})}function buscarAlumno(e){$.ajax({type:"post",url:BASE_URL+"api/alumnos.php?tipo=combo",data:{busqueda:e},dataType:"json",success:function(e){e.estatus&&(console.log(e),$("#alumno").empty(),e.data.forEach((e=>{$("#alumno").append(`<option value="${e.id}">${e.nombre+" "+e.apellido_paterno+" "+e.apellido_materno}</option>`)})),$("#alumno").selectpicker("refresh"))}})}function registrarAlumnoGrupo(){let e=$("#alumno").val(),a=$("#ciclo").val();$.ajax({type:"post",url:BASE_URL+"api/grupos.php?tipo=registrar_alumno",data:{id_alumno:e,id_grupo:id_grupo,id_ciclo:a},dataType:"json",success:function(e){table.ajax.reload(null,!1),e.estatus?Toast.fire({icon:"success",title:e.mensaje}):Toast.fire({icon:"error",title:e.mensaje})}})}function cancelarAlumnoGrupo(e){Swal.fire({icon:"question",title:"¿Deseas dar de baja este alumno del grupo?",showCancelButton:!0,cancelButtonText:"No",confirmButtonText:"Si",showCloseButton:!0}).then((a=>{a.isConfirmed&&$.ajax({type:"post",url:BASE_URL+"api/grupos.php?tipo=cancelar_alumno_grupo",data:{id_registro:e},dataType:"json",success:function(e){table.ajax.reload(null,!1),e.estatus?Toast.fire({icon:"success",title:e.mensaje}):Toast.fire({icon:"error",title:e.mensaje})}})}))}function reactivarAlumnoGrupo(e){Swal.fire({icon:"question",title:"¿Deseas reactivar este alumno del grupo?",showCancelButton:!0,cancelButtonText:"No",confirmButtonText:"Si",showCloseButton:!0}).then((a=>{a.isConfirmed&&$.ajax({type:"post",url:BASE_URL+"api/grupos.php?tipo=reactivar_alumno_grupo",data:{id_registro:e},dataType:"json",success:function(e){table.ajax.reload(null,!1),e.estatus?Toast.fire({icon:"success",title:e.mensaje}):Toast.fire({icon:"error",title:e.mensaje})}})}))}function getParameterByName(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var a=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===a?"":decodeURIComponent(a[1].replace(/\+/g," "))}$("#nombre-grupo").val(nombre_grupo),$("#nivel").val(nivel),$("#grado").val(grado),reloadTable(),$("#alumno").on("shown.bs.select",(function(){$(".bs-searchbox input").off("keyup.miEvento").on("keyup.miEvento",(function(){clearTimeout(debounceTimer);const e=$(this).val().trim();e&&(debounceTimer=setTimeout((()=>{console.log("Buscando:",e),buscarAlumno(e)}),600))}))})),GeneralEventListener("btn-actualizar-grupo","click",actualizarGrupo),GeneralEventListener("btn-registrar-alumno-grupo","click",registrarAlumnoGrupo);