const Toast=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=Swal.stopTimer,e.onmouseleave=Swal.resumeTimer}});import{initCustomDataTable}from"../DataTable/datatables-init.js";import{DataTableListener,GeneralEventListener}from"../utils/listeners.js";let table,debounceTimer;function reloadTable(){$("#role").attr("role");table=initCustomDataTable("#detalle_pregrupo",BASE_URL+"api/grupos.php?tipo=datatable_pregrupo",[{data:"id",title:"#"},{data:"nombre",title:"Nombre"},{data:null,title:"Apellidos",render:e=>e.apellido_paterno+" "+e.apellido_materno},{data:null,title:"Opciones",render:function(e,o,t){return"\n        <div class='row'>\n          <div class='col-12 col-md-12'>\n            <div class=\"btn btn-danger btn-eliminar-alumno\">\n              <i class=\"fa-solid fa-trash\"></i>\n            </div>\n          </div>\n        </div>"}}]),DataTableListener(table,"click",".btn-eliminar-alumno",eliminarAlumnoPreGrupo)}function registrarGrupo(){let e=$("#nombre-horario").val(),o=$("#grado").val(),t=$("#nivel").val(),a=$("#ciclo").val();e||Toast.fire({icon:"error",title:"Escribe un nombre para el grupo"}),o||Toast.fire({icon:"error",title:"Seleccione un grado"}),t||Toast.fire({icon:"error",title:"Selecciona un nivel"}),$.ajax({type:"post",url:BASE_URL+"api/grupos.php?tipo=registrar",data:{nombre:e,nivel:t,grado:o,ciclo:a},dataType:"json",success:function(e){table.ajax.reload(null,!1),e.estatus?(Swal.fire({icon:"success",title:e.mensaje,confirmButtonText:"Entendido",showCloseButton:!0,html:`<h4 style="color:rgba(100, 150, 200)">${e.subtitulo}</h4>`}),$("#nombre-horario").val(""),$("#grado").val(""),$("#nivel").val(""),$("#ciclo").val("")):Swal.fire({icon:"error",title:e.mensaje,confirmButtonText:"Entendido",showCloseButton:!0,html:`<h4 style="color:rgba(100, 150, 200)">${e.subtitulo}</h4>`})}})}function buscarAlumno(e){$.ajax({type:"post",url:BASE_URL+"api/alumnos.php?tipo=combo",data:{busqueda:e},dataType:"json",success:function(e){e.estatus&&(console.log(e),$("#alumno").empty(),e.data.forEach((e=>{$("#alumno").append(`<option value="${e.id}">${e.nombre+" "+e.apellido_paterno+" "+e.apellido_materno}</option>`)})),$("#alumno").selectpicker("refresh"))}})}function registrarAlumnoPreGrupo(){let e=$("#alumno").val();$.ajax({type:"post",url:BASE_URL+"api/grupos.php?tipo=preregistrar",data:{alumno:e},dataType:"json",success:function(e){table.ajax.reload(null,!1),e.estatus?Toast.fire({icon:"success",title:e.mensaje}):Toast.fire({icon:"error",title:e.mensaje})}})}function eliminarAlumnoPreGrupo(e){$.ajax({type:"post",url:BASE_URL+"api/grupos.php?tipo=eliminar_detalle_pregrupo",data:{id_detalle:e},dataType:"json",success:function(e){table.ajax.reload(null,!1),e.estatus?Toast.fire({icon:"success",title:e.mensaje}):Toast.fire({icon:"error",title:e.mensaje})}})}reloadTable(),$("#alumno").on("shown.bs.select",(function(){$(".bs-searchbox input").off("keyup.miEvento").on("keyup.miEvento",(function(){clearTimeout(debounceTimer);const e=$(this).val().trim();e&&(debounceTimer=setTimeout((()=>{console.log("Buscando:",e),buscarAlumno(e)}),600))}))})),GeneralEventListener("btn-registrar-alumno-pregrupo","click",registrarAlumnoPreGrupo),GeneralEventListener("btn-registrar-grupo","click",registrarGrupo);