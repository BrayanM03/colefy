$(document).ready((function(){reloadTable()}));import{initCustomDataTable}from"../DataTable/datatables-init.js";import{DataTableListener,GeneralEventListener}from"../utils/listeners.js";let table_prehorario;const Toast=Swal.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:r=>{r.onmouseenter=Swal.stopTimer,r.onmouseleave=Swal.resumeTimer}});function convertirHora(r){const[a,e]=r.split(":"),t=parseInt(a,10);return`${t%12||12}:${e} ${t>=12?"pm":"am"}`}function reloadTable(){$("#role").attr("role");table_prehorario=initCustomDataTable("#tabla-prehorario",BASE_URL+"api/horarios.php?tipo=prehorarios",[{data:"id",title:"#"},{data:"profesor",title:"Profesor"},{data:"materia",title:"Materia"},{data:"dia",title:"Día"},{data:"hora",title:"Hora",render:r=>convertirHora(r)},{data:null,render:function(r){return"\n          <div class='row'>\n                      <div class='col-12 col-md-12'> \n                         <div class=\"btn btn-danger btn-eliminar-prehorario\"><i class=\"fa-solid fa-trash\"></i></div>\n                      </div>\n                  </div>\n          "}}]),DataTableListener(table_prehorario,"click",".btn-eliminar-prehorario",eliminarPrehorario)}function agregarPrehorario(){let r=validarFormulario();if(r.estatus){let r=$("#profesor").val(),a=$("#materia").val(),e=$("#dia").val(),t=$("#hora").val();$.ajax({type:"post",url:BASE_URL+"servidor/horarios/agregar-detalle-prehorario.php",data:{profesor:r,materia:a,dia:e,hora:t},dataType:"json",success:function(r){r.estatus?(table_prehorario.ajax.reload(null,!1),Toast.fire({icon:"success",title:r.mensaje})):Toast.fire({icon:"error",title:r.mensaje})}})}else Toast.fire({icon:"error",title:r.mensaje})}function validarFormulario(){let r,a=$("#profesor").val(),e=$("#materia").val(),t=$("#dia").val(),o=$("#hora").val();return r=""==a.trim()?{estatus:!1,mensaje:"Selecciona un profesor"}:""==e.trim()?{estatus:!1,mensaje:"Selecciona una materia"}:0==t.length?{estatus:!1,mensaje:"Selecciona un día"}:""==o.trim()?{estatus:!1,mensaje:"Selecciona una hora"}:{estatus:!0,mensaje:"Agregado correctamente"},r}function eliminarPrehorario(r){$.ajax({type:"POST",url:BASE_URL+"api/horarios.php?tipo=eliminar_prehorario&id_prehorario="+r,data:{},dataType:"json",success:function(r){r.estatus?(table_prehorario.ajax.reload(null,!1),Toast.fire({icon:"success",title:r.mensaje})):Toast.fire({icon:"error",title:r.mensaje})}})}function registrarHorario(){let r=$("#nombre-horario").val();if(""==r.trim())return Toast.fire({icon:"error",title:"Escribe un nombre para el horario"}),!1;$.ajax({type:"post",url:BASE_URL+"api/horarios.php?tipo=registrar_horario&nombre="+r,data:{},dataType:"json",success:function(r){r.estatus?Swal.fire({icon:"success",title:r.mensaje,confirmButtonText:"Entendido"}).then((()=>{window.location.reload()})):Swal.fire({icon:"error",title:r.mensaje,confirmButtonText:"Entendido"}).then((()=>{window.location.reload()}))}})}GeneralEventListener("btn-agregar-prehorario","click",agregarPrehorario),GeneralEventListener("btn-registrar-horario","click",registrarHorario);