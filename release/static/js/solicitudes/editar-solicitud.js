function editarSolicitud(e,o=!0){console.log(o),$.ajax({type:"post",url:"../servidor/solicitudes/traer-solicitud.php",data:{id_solicitud:e},dataType:"json",success:function(l){if(l.estatus){let a=calcularEdad(l.datos.fecha_cumple);Swal.fire({didOpen:function(){$("#sexo").val(l.datos.sexo)},width:"650px",html:`\n                    <h2 class="mb-4">Formulario de Registro</h2>\n                    <form id="formulario-solicitante">\n                        <div class="row">\n                            <div class="col-md-8">\n                            \x3c!-- Nombre --\x3e\n                                <div class="mb-3">\n                                    <label for="nombre" class="form-label">Nombre</label>\n                                    <input type="text" class="form-control" id="nombre" value="${l.datos.nombre}" placeholder="Nombre completo" required>\n                                </div>\n                            </div>\n                        \n                            \x3c!-- Edad --\x3e\n                            <div class="col-md-4">\n                                <div class="mb-3">\n                                    <label for="edad" class="form-label">Edad</label>\n                                    <input type="number" value="${a}" class="form-control" id="edad" placeholder="Edad" required>\n                                </div>\n                            </div>\n                        </div>\n                    \n                        <div class="row">\n                            <div class="col-md-6 col-12">\n                            \x3c!-- Nombre --\x3e\n                                <div class="mb-3">\n                                    <label for="nombre" class="form-label">Apellido Paterno</label>\n                                    <input type="text" class="form-control" id="apellido_paterno" value="${l.datos.apellido_paterno}" placeholder="Nombre completo" required>\n                                </div>\n                            </div>\n                        \n                            \x3c!-- Edad --\x3e\n                            <div class="col-md-6 col-12">\n                                <div class="mb-3">\n                                    <label for="edad" class="form-label">Apellido Materno</label>\n                                    <input type="text" value="${l.datos.apellido_materno}" class="form-control" id="apellido_materno" placeholder="Edad" required>\n                                </div>\n                            </div>\n                        </div>\n                          \x3c!-- Sexo --\x3e\n                        <div class="row">\n                          <div class="col-md-4">  \n                              <div class="mb-3">\n                                <label for="sexo" class="form-label">Sexo</label>\n                                <select class="form-select" id="sexo" required>\n                                <option selected disabled>Selecciona una opción</option>\n                                <option value="M">Masculino</option>\n                                <option value="F">Femenino</option>\n                                </select>\n                            </div>\n                          </div>\n                          <div class="col-md-4">  \n                          \x3c!-- País --\x3e\n                            <div class="mb-3">\n                                <label for="pais" class="form-label">País</label>\n                                <input type="text"  value="${l.datos.pais}" class="form-control" id="pais" placeholder="País de residencia" required>\n                            </div>\n                          </div>\n                          <div class="col-md-4">  \n                          \x3c!-- País --\x3e\n                            <div class="mb-3">\n                                <label for="pais" class="form-label">Fecha Nac.</label>\n                                <input type="date"  value="${l.datos.fecha_cumple}" class="form-control" id="fecha_cumple">\n                            </div>\n                          </div>\n                        </div>\n                    \n                          \n                    \n                          \x3c!-- Estado --\x3e\n                          <div class="row">\n                             <div class="col-md-6"> \n                                <div class="mb-3">\n                                    <label for="estado" class="form-label">Estado</label>\n                                    <input type="text" value="${l.datos.estado}" class="form-control" id="estado" placeholder="Estado" required>\n                                </div>\n                            </div>\n                            <div class="col-md-6"> \n                                \x3c!-- Ciudad --\x3e\n                                <div class="mb-3">\n                                    <label for="ciudad" class="form-label">Ciudad</label>\n                                    <input type="text" class="form-control" value="${l.datos.ciudad}" id="ciudad" placeholder="Ciudad" required>\n                                </div>\n                            </div>\n                          </div>\n                    \n                          <div class="row">\n                             <div class="col-md-6">\n                                \x3c!-- Teléfonos --\x3e\n                                <div class="mb-3">\n                                     <label for="telefonos" class="form-label">Teléfonos</label>\n                                     <input type="text" value="${l.datos.telefono}" class="form-control" id="telefono" placeholder="Teléfonos de contacto" required>\n                                </div>\n                             </div>\n                             <div class="col-md-6">\n                                \x3c!-- Teléfonos --\x3e\n                                <div class="mb-3">\n                                    <label for="telefonos" class="form-label">Teléfono casa</label>\n                                    <input type="text" value="${l.datos.telefono_casa}" class="form-control" id="telefono_casa" placeholder="Teléfonos de contacto" required>\n                                </div>\n                            </div>\n                             <div class="col-md-6">\n                                \x3c!-- Correo --\x3e\n                                <div class="mb-3">\n                                    <label for="correo" class="form-label">Correo Electrónico</label>\n                                    <input type="email" value="${l.datos.correo}" class="form-control" id="correo" placeholder="Correo electrónico" required>\n                                </div>\n                             </div>\n                          </div> \n                          <hr>\n                          <h3 class="ml-auto mb-3"><b>Datos de la iglesia</b></h3>\n                          \x3c!-- Iglesia --\x3e\n                          <div class="mb-3">\n                            <label for="iglesia" class="form-label">Iglesia</label>\n                            <input type="text" value="${l.datos.nombre_iglesia}" class="form-control" id="nombre_iglesia" placeholder="Nombre de la Iglesia" required>\n                          </div>\n                    \n                          \x3c!-- Pastor --\x3e\n                          <div class="mb-3">\n                            <label for="pastor" class="form-label">Pastor</label>\n                            <input type="text" value="${l.datos.nombre_pastor}" class="form-control" id="nombre_pastor" placeholder="Nombre del Pastor" required>\n                          </div>\n                    \n                         \n                    \n                          <div class="row">\n                             <div class="col-md-6">\n                             \x3c!-- Teléfono Pastor --\x3e\n                             <div class="mb-3">\n                               <label for="telefono_pastor" class="form-label">Teléfono del Pastor</label>\n                               <input type="text" value="${l.datos.telefono_pastor}" class="form-control" id="telefono_pastor" placeholder="Teléfono del Pastor" required>\n                             </div>\n                            </div>\n                            <div class="col-md-6">\n                            \x3c!-- Curso de interés --\x3e\n                            <div class="mb-3">\n                                <label for="curso_interes" class="form-label">Curso de Interés</label>\n                                <input class="form-control" value="${l.datos.curso_interes}" id="curso_interes" type="text" placeholder="Ejem. Teologia">\n                            </div>\n                            </div>\n                          </div>\n                          </div>\n                          </form>\n                    `,confirmButtonText:"Aprobar",showDenyButton:!0,showConfirmButton:o,denyButtonColor:"#DD6B55",denyButtonText:"Actualizar",showCloseButton:!0}).then((function(o){if(o.isConfirmed)Swal.fire({icon:"info",html:`\n                            <h2 class="mb-4">Creación de usuario para ${l.datos.nombre}</h2>\n                            <div class="row">\n                                <div class="col-md-12">\n                                \x3c!-- Nombre --\x3e\n                                    <div class="mb-3">\n                                        <label for="usuario" class="form-label">Nombre</label>\n                                        <input type="text" class="form-control" id="usuario" placeholder="Usuario" required>\n                                    </div>\n                                </div>\n                                <div class="col-md-12">\n                                \x3c!-- Nombre --\x3e\n                                    <div class="mb-3">\n                                        <label for="password" class="form-label">Contraseña</label>\n                                        <input type="text" class="form-control" id="password" placeholder="******" required>\n                                    </div>\n                                </div>\n                                <div class="col-md-12">\n                                \x3c!-- Nombre --\x3e\n                                    <div class="mb-3">\n                                        <label for="password" class="form-label">Rol</label>\n                                        <select class="form-control" id="rol" onchange="cambioRol()" required>\n                                            \n                                        </select>\n                                    </div>\n                                </div>\n                                <div class="col-md-12 mt-2" id="area-cambio-rol">\n                                </div>\n                            </div>\n                                `,didOpen:function(){let e=$("#rol");l.datos.roles.forEach((o=>{e.append(`\n                                            <option value="${o.id}">${o.nombre}</div>\n                                        `)}))},preConfirm:function(){let e=document.getElementById("usuario").value,o=document.getElementById("password").value;""==e.trim()?Swal.showValidationMessage("Escribe un nombre de usuario"):""==o.trim()&&Swal.showValidationMessage("Escribe una contraseña")},confirmButtonText:"Registrar usuario",showCloseButton:!0}).then((function(e){if(e.isConfirmed){let e,o=l.datos.id,a=document.getElementById("usuario").value,n=document.getElementById("password").value,s=document.getElementById("rol").value;e=3==s?document.getElementById("grupo").value:0,$.ajax({type:"post",url:"../servidor/usuarios/registrar-nuevo.php",data:{id_solicitud:o,usuario:a,password:n,rol:s,id_grupo:e},dataType:"json",success:function(e){if(e.estatus)var o="success";else o="error";Swal.fire({icon:o,title:e.mensaje}),tabla.ajax.reload(null,!1)}})}}));else if(o.isDenied){let o=document.getElementById("formulario-solicitante"),l=new FormData;o.querySelectorAll("input, select").forEach((e=>{const o=e.id,a=e.value;l.append(o,a)})),l.append("id_solicitud",e);const a="../servidor/solicitudes/actualizar-solicitud.php";try{fetch(a,{method:"POST",body:l}).then((e=>e.text())).then((e=>{JSON.parse(e).estatus&&Swal.fire({icon:"success",title:"Actualización existosa",confirmButtonText:"Aceptar"}).then((()=>{document.querySelectorAll("input, select").forEach((e=>{e.value=""}))}))}))}catch(e){console.error("Error:",e)}}}))}}})}function cambioRol(){3==$("#rol").val()&&$.ajax({type:"post",url:"../servidor/grupos/traer-grupos.php",data:{data:"data"},dataType:"json",success:function(e){e.estatus&&($("#area-cambio-rol").empty(),$("#area-cambio-rol").append('\n                        <label>Asigné un grupo</label>\n                        <select class="form-control" id="grupo">\n                           \n                        </select>'),e.data.forEach((e=>{$("#grupo").append(`\n                       <option value="${e.id}">${e.nombre}</option>\n                       `)})))}})}function actualizarUsuario(e){e=parseInt(e);let o=document.getElementById("nombre").value,l=document.getElementById("apellido").value,a=document.getElementById("proyecto").value,n=document.getElementById("sucursal").value,s=document.getElementById("rol").value;$.ajax({type:"POST",url:"../servidor/usuarios/actualizar-usuario.php",data:{id:e,nombre:o,apellido:l,proyecto_id:a,sucursal_id:n,rol:s},dataType:"JSON",success:function(e){1==e.estatus?Toast.fire({icon:"success",title:"Datos actualizados"}):Toast.fire({icon:"error",title:e.mensaje})}})}function obtenerParametroGet(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var o=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===o?"":decodeURIComponent(o[1].replace(/\+/g," "))}function calcularEdad(e){const o=new Date,l=new Date(e);let a=o.getFullYear()-l.getFullYear();const n=o.getMonth()-l.getMonth();return(n<0||0===n&&o.getDate()<l.getDate())&&a--,a}const Toast=Swal.mixin({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.addEventListener("mouseenter",Swal.stopTimer),e.addEventListener("mouseleave",Swal.resumeTimer)}});