import{GeneralEventListener}from"../utils/listeners.js";const id_rol=ID_ROL;$(document).ready((function(){const s=$("#area-permisos");s.empty().append('\n        <div class="row">\n            <div class="col-12 text-center">\n                <dotlottie-wc\n                    class="m-auto"\n                    src="https://lottie.host/16abd1c5-90bb-4e18-b98b-a616ac4b71ff/Y552obLciD.lottie"\n                    style="width: 120px;height: 120px"\n                    autoplay\n                    loop></dotlottie-wc>\n            </div>\n        </div>\n    '),setTimeout((()=>{$.ajax({type:"post",url:BASE_URL+"/api/permisos.php?tipo=ver_lista_permisos_x_rol",data:{id_rol:id_rol},dataType:"json",success:function(e){if(e.estatus){s.empty();const t=e.data.reduce(((s,e)=>{const t=e.id_categoria||0;return s[t]||(s[t]={nombre:e.categoria??"General",permisos:[]}),s[t].permisos.push(e),s}),{});s.html("");const n={SELECT:"eye",CREATE:"plus-circle",UPDATE:"edit",CANCEL:"trash-2"};Object.entries(t).forEach((([e,t])=>{const i=`collapse_categoria_${e}`;t.permisos.sort(((s,e)=>s.bandera-e.bandera));let o="";t.permisos.forEach((s=>{o+=`\n                        <li class="list-group-item ps-4">\n                            <div class="row">\n                                <div class="col-6 col-md-8">\n                                <i data-feather="${n[s.tipo]??"help-circle"}"></i>\n\n                                    <strong>${s.permiso}</strong>\n                                    <br>\n                                    <small class="text-muted">${s.descripcion}</small>\n                                </div>\n                                <div class="col-6 col-md-4">\n                                    <label class="switch">\n                                        <input type="checkbox"\n                                            class="permiso-switch"\n                                            data-permiso="${s.id}"\n                                            ${1==s.activo?"checked":""}>\n                                        <span class="slider"></span>\n                                    </label>\n                                </div>\n                            </div>\n                        </li>\n\n                        \n                    `})),s.append(`\n                <div class="col-12 mb-3">\n                    <ul class="list-group list-group-flush">\n        \n                        <li class="list-group-item d-flex align-items-center py-2"\n                            data-bs-toggle="collapse"\n                            href="#${i}"\n                            role="button"\n                            aria-expanded="false"\n                            aria-controls="${i}">\n                            <i class="align-middle" data-feather="chevron-right"></i>\n                            <strong class="fs-4">${t.nombre}</strong>\n                        </li>\n        \n                        <div class="collapse" id="${i}">\n                            <div class="card card-body p-0">\n                                <ul class="list-group list-group-flush">\n                                    ${o}\n                                </ul>\n                            </div>\n                        </div>\n        \n                    </ul>\n                </div>\n            `)})),feather.replace()}}})}),1400)})),$(document).on("change",".permiso-switch",(function(){const s=$(this),e=s.data("permiso"),t=s.is(":checked")?1:0;$.ajax({type:"post",url:BASE_URL+"api/permisos.php?tipo=gestion_permiso_rol",data:{accion:"actualizar",id_rol:id_rol,id_permiso:e,valor:t},dataType:"json",success:function(s){s.estatus?Toast.fire({icon:"success",title:s.mensaje}):Toast.fire({icon:"warning",title:s.mensaje})},error:function(){alert("Error de conexiÃ³n con el servidor")}})}));const Toast=Swal.mixin({toast:!0,position:"bottom-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:s=>{s.addEventListener("mouseenter",Swal.stopTimer),s.addEventListener("mouseleave",Swal.resumeTimer)}});